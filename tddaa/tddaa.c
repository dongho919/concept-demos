/* A 3D array can be created with only three allocations.
 * For example, a 2x3x4 array, visualized below, can be created
 *
 *       +--+--+--+--+
 *      /  /  /  /  /|
 *     +--+--+--+--+ |
 *    /  /  /  /  /|/|
 *   +--+--+--+--+ | |
 *  /  /  /  /  /|/|/
 * +--+--+--+--+ | /
 * |  |  |  |  |/|/
 * +--+--+--+--+ /
 * |  |  |  |  |/
 * +--+--+--+--+
 * 
 * - A "slice" is a horizontal layer from the array; there are 2 slices
 * - A "row" is a row of data taken from a particular slice; there are 3 rows in
 *   each slice (2x3 = 6 rows total)
 * - A "data" is an integer taken from a particular row; there are 4 data in
 *   each row (2x3x4 = 24 data total)
 *
 * For the sake of simplicity, let's use array subscript notation to visualize
 * what each array allocated contains:
 *
 *          +-----+-----+
 *  slices: | [0] | [1] |
 *          +-----+-----+
 *             |     |
 *             |     +---------------------+
 *             V                           V
 *          +--------+--------+--------+--------+--------+--------+
 *  rows:   | [0][0] | [0][1] | [0][2] | [1][0] | [1][1] | [1][2] |
 *          +--------+--------+--------+--------+--------+--------+
 *             |         |        |        |        |        |
 *             |         |        |        |        |        +----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
 *             |         |        |        |        +-------------------------------------------------------------------------------------------------------------------------------------------------------------+                                               |
 *             |         |        |        +----------------------------------------------------------------------------------------------------------------------+                                               |                                               |
 *             |         |        +-------------------------------------------------------------------------------+                                               |                                               |                                               |
 *             |         +----------------------------------------+                                               |                                               |                                               |                                               |
 *             V                                                  V                                               V                                               V                                               V                                               V
 *          +-----------+-----------+-----------+-----------+-----------+-----------+-----------+-----------+-----------+-----------+-----------+-----------+-----------+-----------+-----------+-----------+-----------+-----------+-----------+-----------+-----------+-----------+-----------+-----------+
 *  data:   | [0][0][0] | [0][0][1] | [0][0][2] | [0][0][3] | [0][1][0] | [0][1][1] | [0][1][2] | [0][1][3] | [0][2][0] | [0][2][1] | [0][2][2] | [0][2][3] | [1][0][0] | [1][0][1] | [1][0][2] | [1][0][3] | [1][1][0] | [1][1][1] | [1][1][2] | [1][1][3] | [1][2][0] | [1][2][1] | [1][2][2] | [1][2][3] |
 *          +-----------+-----------+-----------+-----------+-----------+-----------+-----------+-----------+-----------+-----------+-----------+-----------+-----------+-----------+-----------+-----------+-----------+-----------+-----------+-----------+-----------+-----------+-----------+-----------+
 */

int *** allocate( int d1, int d2, int d3 ) 
{
    int i, j;
    int* data = malloc(d1 * d2 * d3 * sizeof(int));
    int** rows = malloc(d1 * d2 * sizeof(int*));
    int*** slices = malloc(d1 * sizeof(int**));

    for (i = 0; i < d1; ++i)
    {
        slices[i] = rows + i * d2;
        for (j = 0; j < d2; ++j)
        {
            slices[i][j] = data + i * d2 * d3 + j * d3;
        }
    }
    return slice;
}

void deallocate( int *** ppp ) 
{
    free(ppp[0][0]);
    free(ppp[0]);
    free(ppp);
}